name: dotnet.test
description: Allows to test a built dotnet project and upload the result to TestSpace

inputs:
  artifact_name:
    description: Name of the artifact that contains the build application

runs:
  using: composite
  steps:
    - name: Download Artifacts
      uses: actions/download-artifact@v4
      with:
        name: ${{ inputs.artifact_name }}

    - name: Test
      run: dotnet test *.Test.*.dll --results-directory test-results --logger trx --collect:"XPlat Code Coverage;Format=cobertura"
      shell: bash
      continue-on-error: true

    - name: Install TestSpace CLI
      uses: testspace-com/setup-testspace@v1
      with:
        domain: ${{ github.repository_owner }}

    - name: Debug
      run: ls -a
      shell: |
        cd test-results
        bash

    - name: Publish Test Result
      run: testspace test-results/*.trx test-results/**/coverage.cobertura.xml
      shell: bash
